#!/usr/bin/php
<?php
/**
 * ホームディレクトリの容量チェック
 */

echo "\n### du -sm ~/* ###\n";
$output = array();
$directories = array();
exec('sudo du -sm * | sort -nr | head -10', $output);
foreach($output as $val) {
    $val = split("\t", $val);
    if ($val[0] < 100) {
        continue;
    }
    $directories[] = $val;
    if (is_dir($val[1])) {
        $val[1] .= '/';
    }
    echo "{$val[0]}	{$val[1]}\n";
}


for ($i=1; $i<=3; $i++) {
    $directories = array_slice($directories, 0, 10);
    echo "\n### du -sm ~" . str_repeat('/*', $i) . " ###\n";
    $output = array();
    $home = array();
    foreach($directories as $val) {
        if (is_dir($val[1])) {
            $home []= "'" . $val[1] . "'";
        }
    }
    $home = implode(',', $home);

    echo("\n" . 'sudo du -sm {' . $home . '}/* | sort -nr | head -30' . "\n");
    $directories = array();
    exec('sudo du -sm {' . $home . '}/* | sort -nr | head -30', $output);
    foreach($output as $val) {
        $val = split("\t", $val);
        if ($val[0] < 100) {
            continue;
        }
        $directories[] = $val;
        if (is_dir($val[1])) {
            $val[1] .= '/';
        }
        echo "{$val[0]}	{$val[1]}\n";
    }
}
