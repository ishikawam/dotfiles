# CLAUDE.md - グローバル設定

このファイルはすべてのプロジェクトでClaude Code (claude.ai/code) に対するグローバルなガイダンスを提供します。

## 言語設定

**日本語での対応**
- すべてのやり取りを日本語で行ってください
- 特別に他の言語を要求されない限り、日本語で回答してください
- 技術的な内容も日本語で説明してください

## 重要なルール

**明示的な要求なしにコードをコミットしない**
- ユーザーが明示的にコミットを要求しない限り、`git commit`を実行しないでください
- `git add`と`git commit`を自動的に実行しないでください
- 変更をコミットする前に必ず確認を取ってください
- ユーザーはバージョン管理にコミットする前に変更を確認したいと考えています
- このルールは絶対に遵守し、常に従わなければなりません

**GITコミットポリシー - 重要ルール**
- **ユーザーが「git commit」と言った時、絶対に`git add`を実行しない**
- ユーザーが「git commit」と言った時は、`git commit`コマンドのみを実行してください
- 関連ファイルであっても、ファイルを自動的にステージングしないでください
- ユーザーがコミットを要求した際は、いかなる状況でも`git add`を実行しないでください
- ユーザーが既にステージングしたファイルのみをコミットしてください
- ステージングされたファイルがない場合は、コミットする変更がないことをユーザーに伝えてください
- これは交渉の余地のないルールで、正確に従わなければなりません
- **`git commit`実行前は必ず`git status`で確認する**
- コミット可能な変更があるかどうかを事前に確認してからコミットを実行する

**ファイル作成ポリシー**
- 要求されたことを行う。それ以上でも以下でもない
- 目的を達成するために絶対に必要でない限り、ファイルを作成しないでください
- 新しいファイルを作成するより、既存のファイルを編集することを常に優先してください
- ユーザーが明示的に要求した場合のみ、ドキュメントファイルを作成してください

**プロジェクト初期化ポリシー**
- **新しいプロジェクトの開始時またはユーザーが`init`コマンドを実行した時は以下のファイルを必ず生成する：**
  - .editorconfig（コード書式統一）
  - README.md（プロジェクト説明とセットアップ手順）
  - .gitignore（プロジェクトタイプに応じた適切な除外ルール）
  - Makefile（依存関係管理とビルドコマンド、必要に応じて）
- **自動生成の条件：**
  - 「init」「初期化」「setup」「セットアップ」「プロジェクト作成」等のキーワード
  - 新規プロジェクトディレクトリでの作業開始時
  - ユーザーが明示的に初期ファイル作成を要求した時

**gitignoreポリシー**
- **必要最小限の除外ルールのみを記載する**
- プロジェクトに実際に存在するファイル/ディレクトリのみを除外対象とする
- 汎用的すぎるルールや使用しない技術のルールは含めない
- 余計なエントリを追加しない
- **絶対パス指定を厳格に使用する**
- ルートディレクトリ基準で `/` から始める（例：`/node_modules/`, `/*.html`）
- サブディレクトリも含める必要がある場合のみ相対パス指定を使用
- 相対パス指定は例外的な場合のみ許可（意図的にサブディレクトリを含む場合）

**.editorconfigポリシー**
- **作成した.editorconfigルールを厳格に遵守する**
- ファイル編集時は必ず.editorconfigの設定に従う
- インデント、文字エンコーディング、改行コードを統一する
- 設定と異なるスタイルで編集しない
- **ファイル作成・修正時の必須チェック：**
- 新しいファイルを作成する前に.editorconfigの設定を確認する
- 既存ファイルを修正する前に.editorconfigの設定を確認する
- 適切なインデント（スペース2文字、Makefileはタブ）を使用する
- 末尾改行（insert_final_newline = true）を必ず追加する
- 末尾空白の除去（trim_trailing_whitespace = true、*.mdは除外）を行う
- UTF-8エンコーディングとLF改行コードを使用する

**セキュリティのベストプラクティス**
- 常にセキュリティのベストプラクティスに従ってください
- 秘密情報やキーを露出またはログ出力するコードを導入しないでください
- 秘密情報やキーをリポジトリにコミットしないでください

**コードスタイル**
- 要求されない限り、コメントを追加しないでください
- ファイルを変更する際は、まずそのファイルのコード規約を理解してください
- コードスタイルを模倣し、既存のライブラリとユーティリティを使用し、既存のパターンに従ってください
- **ソースコードのコメントはすべて日本語で書く**

**依存関係管理ポリシー - 重要ルール**
- **brewで依存関係をインストールする前に、必ずMakefileを作成する**
- brewでツールをインストールする必要がある場合は、まず`make install`ターゲットを含むMakefileを作成/更新してください
- 他の開発者が`make install`で同じ環境を再現できることを確認してください
- **外部ツール（gh、jq等）の依存関係もMakefileで管理する**
- GitHub CLIやjqなどの外部コマンドラインツールもMakefileの`install`ターゲットに含めてください
- プロジェクトで使用するすべてのツールが`make install`で一括インストールできるようにしてください
- **絶対にグローバル環境にプログラミング言語パッケージをインストールしない**
- **すべての言語でローカル環境管理を使用する：**
  - Python: pyenvローカル環境、.python-versionとrequirements.txt
  - Node.js: nodenvローカル環境、.node-versionとpackage.json
  - Ruby: rbenvローカル環境、.ruby-versionとGemfile
  - Go: goenvローカル環境、.go-versionとgo.mod
  - Java: jenvローカル環境、.java-version
  - Rust: rustupローカル環境（rust-toolchain.toml）
- これは一時的な作業や単発ツールも含む、すべてのセッションに適用されます
- このルールは絶対に遵守し、常に従わなければなりません

**GitHub CLI認証ポリシー**
- **`gh auth login`は必要に応じて実行する**
- GitHub APIを使用するプロジェクトでは、セットアップ手順に`gh auth login`を含めてください
- 認証が必要なコマンドを実行する前に、認証状態を確認してください
- 認証エラーが発生した場合は、ユーザーに`gh auth login`の実行を案内してください

**Terraformプロジェクトポリシー**
- **Terraformの初期化とフォーマット**
  - `terraform init`は`make install`または`make install-base`コマンドで実行する
  - Terraformファイルのフォーマットは`make fmt`コマンドで実行する
  - 手動でterraformコマンドを直接実行せず、Makefileで定義されたコマンドを使用する
- **AWS認証とプロファイル管理**
  - AWS CLIの認証は`make login`コマンドを使用する
  - プロジェクト固有のAWSプロファイルが設定されている場合は、それを尊重する
  - IAM Identity Centerを使用している場合は、適切なSSOログインコマンドを使用する
- **セキュリティ**
  - 本番環境への変更は特に慎重に実行し、事前確認を徹底する
- **環境別設定管理**
  - 環境ごとに独立したディレクトリ構成を使用する（`env_dev/`, `env_prod/`等）
  - 共通モジュールは`common/`や`modules/`ディレクトリで管理する
  - 環境固有の変数は`terraform.tfvars`ファイルで管理する
  - 各環境は独立して初期化し、相互に影響しないようにする

**プライバシー・セキュリティルールの拡張**
- **Gitトラッキング状況の必須確認**
  - ファイルを削除・変更する前に`git ls-files`で追跡状況を確認する
  - Gitで追跡されていないファイルは絶対に削除・変更しない
  - 個人の`.env`ファイルは秘密のトークンや認証情報を含むため、明示的に要求されない限り変更しない
- **プライベートデータとパブリックデータの区別**
  - 常に以下を区別して扱う：
    - Git追跡ファイル（オープンソース向けに変更可能）
    - ユーザーのプライベートファイル（許可なしに絶対に触らない）
  - 変更前に必ず`git status`と`git ls-files`で追跡状況を理解する
- **機密情報の保護**
  - コードや追跡ファイルに個人情報（URL、名前、トークン）をハードコードしない
  - プライベートデータを含むファイルは特別な注意を払って扱う
  - テンプレートファイル（`.env.example`、`.sample.md`）のみ変更可能
- **プライベートディレクトリの保護**
  - ダウンロードディレクトリやユーザー作成ディレクトリは個人データを含む
  - これらのディレクトリのファイルは明示的な許可なしに変更しない

**データセキュリティポリシー**
- **機密データの取り扱い**
  - ファイルに機密性の高い個人情報や業績データが含まれている場合は慎重に扱う
  - 分析やレポート作成時は個人情報に配慮する
  - 機密情報を含むファイルの内容を外部に漏洩させない

**プロジェクト開発準備ポリシー**
- **新しいプロジェクト開発時の段階的手順**
  - 開発環境構築を必須化する
- **API連携プロジェクトポリシー**
  - 外部API連携プロジェクトでは設計確認事項を明確にする
  - 環境変数管理を必須化する
  - .envテンプレート作成とAPI認証情報の安全管理を行う
  - 定期的なデータ取得・分析処理が必要な場合はバッチ処理システムを設計に含める

**ドキュメント連動管理ポリシー**
- **関連ファイル群の整合性確保**
  - 提案書・見積書・仕様書・構成図など、相互に関連するドキュメント群は整合性を維持する
  - 一つのファイルを更新する際は、関連ファイルへの影響を必ず確認する
  - 金額・工数・技術スタック・システム構成の一貫性を保つ
- **更新時の必須チェック項目**
  - 金額・工数: 提案書と詳細見積書の整合性
  - 技術スタック: API仕様書と提案書の技術選定
  - システム構成: 構成図と各ドキュメントのアーキテクチャ記述
  - プロジェクトスコープ: 要件定義と提案書の機能範囲

**依頼元ドキュメント保護ポリシー**
- **原本ドキュメントの厳格な保護**
  - 依頼元・クライアントから提供された原本ドキュメントは絶対に変更・削除しない
  - 契約書類、要件定義書、仕様書などの原本は参照のみ可能
  - 改変・削除は契約違反となる可能性があるため厳禁
  - 原本ディレクトリ（例：`docs/from_client/`）は編集対象外として明記

**Excel/CSV変換管理ポリシー**
- **バイナリファイル変換の標準化**: Excelファイルは必ずCSV形式に変換してからAI処理を行う
- **変換ツールの活用**: 専用の変換ツール（excel-converter等）を使用し、手動変換は避ける
- **自動化コマンドの実装**: `make convert`のような自動化コマンドで変換作業を効率化する

**Dockerコンテナ管理ポリシー**
- **標準的なDockerコンテナ管理コマンド**
  - `make up` - すべてのサービスをdocker-composeで起動
  - `make down` - すべてのサービスを停止
  - `make destroy` - コンテナ、ボリューム、ログをクリーンアップ
  - docker-composeを使用するプロジェクトではMakefileでこれらのコマンドを統一する

**テスト実行ポリシー**
- **標準的なテストコマンド**
  - `make test` - APIテストをカバレッジ付きで実行
  - `make unittest` - ユニットテストを実行
  - `make coverage` - カバレッジレポートを生成しHTMLレポートを開く
- **個別テスト実行**
  - Dockerコンテナ内でのテスト実行も考慮する
  - `docker-compose exec [service] go test -v ./[package-path]` パターンの使用

**コード品質管理ポリシー**
- **標準的なコード品質チェックコマンド**
  - `make lint` - リンティング実行（言語別の標準ツール使用）
  - `make fmt` - コードフォーマット実行
  - `make check` - 静的解析実行（staticcheck等）
- **Go言語での品質管理**
  - gofmt、goreturns、golint、golangci-lintの活用
  - Dockerコンテナ内でのリンティングも考慮する

**Go言語開発ポリシー**
- **標準的なプロジェクト構成パターン**
  - `cmd/` - 実行可能ファイル（server/、batch/、worker/等）
  - `handlers/` - HTTPリクエストハンドラ
  - `models/` - データモデル
  - `service/` - ビジネスロジック
  - `middleware/` - HTTPミドルウェア
  - `routers/` - ルート定義
  - `pkg/` - 共有パッケージ
  - `resources/` - 静的アセット、テンプレート
  - `settings/` - 設定管理
- **環境設定管理**
  - 設定ファイルは`env/`ディレクトリで環境別管理
  - `cp env/local.ini app.ini`パターンでローカル設定をコピー
  - 本番用とテスト用の設定を分離する

**Laravel/PHP開発ポリシー**
- **標準的なLaravel開発コマンド**
  - `make setup` - 初期セットアップ（.env作成、Docker環境構築）
  - `make install` - 依存関係インストール、環境設定、キャッシュクリア
  - `make migrate` - データベースマイグレーション実行
  - `make dev` - 開発環境起動
  - `make up` - Dockerコンテナ起動
  - `make down` - Dockerコンテナ停止
  - `make exec` または `make exec-app` - PHPコンテナにSSH接続
  - `make log` - Laravel ログを tail する
- **コード品質管理（Laravel）**
  - `make fix` - Laravel Pintでコード整形（PSR-12準拠）
  - `make analyse` - PHPStanで静的解析（レベル5）
  - `make test-phpstan` - PHPStan静的解析実行
  - `make generate-phpstan-baseline` - PHPStanベースライン更新
  - `make test-pint` - Pintコードスタイルチェック
  - `make fix-pint` - Pintコードスタイル自動修正
- **Laravel/PHPテスト実行**
  - `docker compose exec php ./vendor/bin/phpunit` - 全テスト実行
  - `docker compose exec php ./vendor/bin/phpunit tests/Unit` - 単体テストのみ実行
  - `docker compose exec php ./vendor/bin/phpunit tests/Feature` - 機能テストのみ実行
  - `docker compose exec php ./vendor/bin/phpunit tests/Unit/ExampleTest.php` - 特定のテストファイル実行
  - `docker compose exec php ./vendor/bin/phpunit --filter testExample` - 特定のテストメソッド実行
- **API文書化管理**
  - `make create-swagger` - Swagger文書生成
  - Swagger UIアクセス: `http://localhost:8081/api/documentation`
- **Laravel開発規約**
  - Laravel Pint: PSR-12準拠のコード整形ツール。全PHPファイルを自動整形
  - PHPStan: 静的解析ツール。型安全性とコード品質をチェック
  - Editorconfig: インデント4スペース、UTF-8、LF改行コードを使用
- **必須のコンテナ実行**
  - すべてのLaravel/PHP/Composerコマンドは**必ずDockerコンテナ内**で実行する
  - 正しい実行方法: `docker compose exec php php artisan migrate`, `docker compose run php composer install`, `make exec`
  - 絶対に避ける: `php artisan migrate`（ホストのPHPを使用）, `composer install`（ホストのComposerを使用）
- **ログ確認とデバッグ**
  - `make log` - リアルタイムログ監視
  - `docker compose exec php tail -f storage/logs/laravel.log` - 特定ログファイル確認
  - ログは`storage/logs/`に保存される

**テストポリシーの拡張**
- **テスト品質管理**
  - カバレッジレポートを生成し、適切なカバレッジを維持する
  - ユニットテスト、統合テスト、E2Eテストを適切に分離する
  - テストデータはテスト専用のものを使用し、本番データを使用しない

**環境設定管理ポリシー**
- **複数環境対応**
  - 環境別設定ファイルを適切に分離する（local, develop, staging, production等）
  - 環境変数は.envファイルで管理し、機密情報は適切に保護する
  - API エンドポイントは環境に応じて自動切り替えする
  - 本番環境と開発環境で異なる設定が必要な項目を明確にする

**静的サイト開発ポリシー（AWS S3/CloudFront）**
- **標準的なAWS静的サイト構成**
  - S3静的サイトホスティング + CloudFront CDN配信
  - Route 53ドメイン管理（オプション）
  - CloudFront経由でのHTTPS自動対応

**Excel/CSV分析処理ポリシー**
- **バイナリファイルの適切な処理**
  - Excelファイルは必ずCSV形式に変換してからAI処理を行う
  - 分析やレポート作成時は個人情報・機密データに特に配慮する

**制限ファイル**
- ~/.config/git/ignoreを変更または触らないでください
- このファイルは常に手を付けずにそのままにしておかなければなりません
